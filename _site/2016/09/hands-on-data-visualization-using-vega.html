<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- <title>VDA-lab :: Hands-on data visualization using vega</title> -->
  <!-- <meta name="description" content="This is the vega (http://vega.github.io/) version of the Processing tutorial that I published earlier. There are also py-processing and p5 versions. Vega is ..."> -->

  <link rel="stylesheet" href="/css/main.css">
  <!-- <link rel="canonical" href="http://ai.uhasselt.be/2016/09/hands-on-data-visualization-using-vega"> -->
  <link rel="alternate" type="application/rss+xml" title="AI @ UHasselt" href="http://ai.uhasselt.be/feed.xml" />
  <link href="https://fonts.googleapis.com/css?family=Lato|Open+Sans|Roboto" rel="stylesheet">

  <!-- Begin Jekyll SEO tag v2.0.0 -->
<title>Hands-on data visualization using vega - AI @ UHasselt</title>
<meta property="og:title" content="Hands-on data visualization using vega" />
<meta name="description" content="This is the vega (http://vega.github.io/) version of the Processing tutorial that I published earlier. There are also py-processing and p5 versions. Vega is a declarative version of the very popular D3 toolkit. This tutorial holds numerous code snippets that can by copy/pasted and modified for your own purpose." />
<meta property="og:description" content="This is the vega (http://vega.github.io/) version of the Processing tutorial that I published earlier. There are also py-processing and p5 versions. Vega is a declarative version of the very popular D3 toolkit. This tutorial holds numerous code snippets that can by copy/pasted and modified for your own purpose." />
<link rel="canonical" href="http://ai.uhasselt.be/2016/09/hands-on-data-visualization-using-vega" />
<meta property="og:url" content="http://ai.uhasselt.be/2016/09/hands-on-data-visualization-using-vega" />
<meta property="og:site_name" content="AI @ UHasselt" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-09-14T23:48:00+02:00" />
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "Hands-on data visualization using vega",
    "datePublished": "2016-09-14T23:48:00+02:00",
    "description": "This is the vega (http://vega.github.io/) version of the Processing tutorial that I published earlier. There are also py-processing and p5 versions. Vega is a declarative version of the very popular D3 toolkit. This tutorial holds numerous code snippets that can by copy/pasted and modified for your own purpose.",
    "logo": "http://ai.uhasselt.be/assets/vda-lab_logo.png",
    "url": "http://ai.uhasselt.be/2016/09/hands-on-data-visualization-using-vega"
  }
</script>
<!-- End Jekyll SEO tag -->
</head>


  <body>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-2131816-8', 'auto');
  ga('send', 'pageview');

</script>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">AI @ UHasselt</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
        
          
        
          
              <!--  If we want to add color to the links -->
              <!-- <a style="background-color:" href="/"  class="page-link" >
                Home
              </a> -->
              <a href="/"  class="page-link" >
                Home
              </a>
          
        
          
              <!--  If we want to add color to the links -->
              <!-- <a style="background-color:#b3e2cd" href="/people"  class="page-link" >
                People
              </a> -->
              <a href="/people"  class="page-link" >
                People
              </a>
          
        
          
              <!--  If we want to add color to the links -->
              <!-- <a style="background-color:#fdcdac" href="/portfolio"  class="page-link" >
                Portfolio
              </a> -->
              <a href="/portfolio"  class="page-link" >
                Portfolio
              </a>
          
        
          
              <!--  If we want to add color to the links -->
              <!-- <a style="background-color:#e6f5c9" href="/publications"  class="page-link" >
                Publications
              </a> -->
              <a href="/publications"  class="page-link" >
                Publications
              </a>
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">Hands-on data visualization using vega</h1>
    <p class="post-meta">Sep 14, 2016 • Jan Aerts</p>
  </header>

  <article class="post-content">
    <p>This is the vega (<a href="http://vega.github.io/">http://vega.github.io/</a>) version of the Processing tutorial that I published <a href="/2015/03/hands-on-data-visualization-using-processing-the-python-version/index.html">earlier</a>. There are also <a href="/2015/03/hands-on-data-visualization-using-processing-the-python-version">py-processing</a> and <a href="/2015/10/hands-on-data-visualization-using-p5">p5</a> versions. Vega is a declarative version of the very popular <a href="http://d3js.org">D3</a> toolkit. This tutorial holds numerous code snippets that can by copy/pasted and modified for your own purpose.</p>

<p>The tutorial is written as much as possible in an incremental way. We start with something simple, and gradually add little bits and pieces that allow us to make more complex visualizations. So make sure to not skip parts of the tutorial: everything depends on everything that precedes it.</p>

<p><img src="/assets/flights_double.png" alt="A pretty picture" /></p>

<p><em>Figure 1 - A pretty picture</em></p>

<h2 id="introduction-to-vega">Introduction to Vega</h2>
<p>Vega is a <em>declarative</em> markup language, which means that you basically describe <em>what</em> you want to see, not <em>how</em> it is done. So you will not find <code class="highlighter-rouge">for</code>-loops or declaration of variables.</p>

<p>A “<em>vega spec</em>” is defined as a json file, which describes at least the <em>data</em>, and the <em>marks</em> that should be presented on the screen. Let’s have a look at a minimal spec file:</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"width"</span><span class="p">:</span><span class="w"> </span><span class="mi">400</span><span class="p">,</span><span class="w">
  </span><span class="nt">"height"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
  </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"table"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"values"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="nt">"x"</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w">  </span><span class="nt">"y"</span><span class="p">:</span><span class="w"> </span><span class="mi">28</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="nt">"x"</span><span class="p">:</span><span class="w"> </span><span class="mi">39</span><span class="p">,</span><span class="w">  </span><span class="nt">"y"</span><span class="p">:</span><span class="w"> </span><span class="mi">83</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="nt">"x"</span><span class="p">:</span><span class="w"> </span><span class="mi">126</span><span class="p">,</span><span class="w">  </span><span class="nt">"y"</span><span class="p">:</span><span class="w"> </span><span class="mi">53</span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nt">"marks"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"symbol"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"from"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="s2">"table"</span><span class="p">},</span><span class="w">
      </span><span class="nt">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"enter"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"x"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"x"</span><span class="p">},</span><span class="w">
          </span><span class="nt">"y"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"y"</span><span class="p">},</span><span class="w">
          </span><span class="nt">"size"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">},</span><span class="w">
          </span><span class="nt">"fill"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"steelblue"</span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>You can try this out in the inline vega editor at <a href="https://vega.github.io/vega-editor/?mode=vega">https://vega.github.io/vega-editor/?mode=vega</a>. You’ll get something like this:</p>

<p><img src="/assets/vega-one.png" alt="vega-one" /></p>

<p><em>Figure 2 - A simple vega plot</em></p>

<p>Let’s go through this spec:</p>

<ul>
  <li><code class="highlighter-rouge">width</code> and <code class="highlighter-rouge">height</code>: define the size of the canvas</li>
  <li><code class="highlighter-rouge">data</code>: This is where we define the data. First of all, we give the data a <code class="highlighter-rouge">name</code> which we can refer to later. The actual values can be hard-coded in this file (as is done here with the keyword <code class="highlighter-rouge">values</code> and an array), or can be loaded from a file or url (see later).</li>
  <li><code class="highlighter-rouge">marks</code>: Define the mark (circle, text, rectangle, line, …) that should be drawn for each datapoint. This object has 3 parts:
    <ul>
      <li><code class="highlighter-rouge">type</code>: <em>what</em> should be drawn: a rectangle, symbol (default is a circle), line, etc</li>
      <li><code class="highlighter-rouge">from</code>: which data this should be applied to; in this case the dataset with the name <code class="highlighter-rouge">table</code>.</li>
      <li><code class="highlighter-rouge">properties</code>: describe the specifics of the marks: position and appearance, for example. You see that the value for <code class="highlighter-rouge">x</code> and <code class="highlighter-rouge">y</code> says <code class="highlighter-rouge"><span class="p">{</span><span class="nt">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"something"</span><span class="p">}</span></code>, whereas that for <code class="highlighter-rouge">size</code> and <code class="highlighter-rouge">fill</code> uses <code class="highlighter-rouge"><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"something"</span><span class="p">}</span></code>. That’s a crucial difference. Whenever you want to use a fixed value, use <code class="highlighter-rouge">"value"</code>; if you want to refer to a value that is in the dataset (e.g. as a key in the json object as shown here, or a column name in a csv file) use <code class="highlighter-rouge">"field"</code>. We’ll see an additional option a bit later: <code class="highlighter-rouge">"signal"</code>.</li>
    </ul>
  </li>
</ul>

<h2 id="setting-things-up">Setting things up</h2>
<p>Although we used the online vega editor above, we’ll need to use another approach if we want to load data from a file. In our case, we will have a CSV file with flights between airports. We will basically need to have 3 files:</p>

<ul>
  <li>an <code class="highlighter-rouge">index.html</code> which we will open in a web browser</li>
  <li>the spec file (let’s call is <code class="highlighter-rouge">spec.json</code>)</li>
  <li>the datafile (in our case: <code class="highlighter-rouge">flights.csv</code>)</li>
</ul>

<p><code class="highlighter-rouge">index.html</code> should look like this:</p>

<div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Flights visualization<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://vega.github.io/vega-editor/vendor/d3.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://vega.github.io/vega-editor/vendor/d3.geo.projection.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://vega.github.io/vega-editor/vendor/topojson.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://vega.github.io/vega-editor/vendor/d3.layout.cloud.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://vega.github.io/vega/vega.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"vis"</span><span class="nt">&gt;&lt;/div&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
<span class="c1">// parse a spec and create a visualization view</span>
<span class="kd">function</span> <span class="nx">parse</span><span class="p">(</span><span class="nx">spec</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">vg</span><span class="p">.</span><span class="nx">parse</span><span class="p">.</span><span class="nx">spec</span><span class="p">(</span><span class="nx">spec</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">chart</span><span class="p">)</span> <span class="p">{</span> <span class="nx">chart</span><span class="p">({</span><span class="na">el</span><span class="p">:</span><span class="s2">"#vis"</span><span class="p">}).</span><span class="nx">update</span><span class="p">();</span> <span class="p">});</span>
<span class="p">}</span>
<span class="nx">parse</span><span class="p">(</span><span class="s2">"spec.json"</span><span class="p">);</span>
<span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre>
</div>
<p>This will load all dependencies. The crucial part is the line saying <code class="highlighter-rouge">parse("spec.json")</code>. That’s the place that indicates what the name of the specification file is.</p>

<p>Do <em>not</em> use Microsoft Word to create these files! Code editors include <a href="https://atom.io/">atom</a>, <a href="http://www.sublimetext.com/">Sublime Text</a>, <a href="https://macromates.com/">TextMate</a> or just <a href="https://notepad-plus-plus.org/">Notepad</a> if you’re on Windows.</p>

<h4 id="running-a-webserver">Running a webserver</h4>
<p>So how do you “run” this visualization? You do this by running a local webserver. Depending on your operating system, there are several options for this. Getting these installed is not within the scope of this tutorial. In short, if you have <code class="highlighter-rouge">python</code> installed, type in <code class="highlighter-rouge">python -m SimpleHTTPServer</code> on the command line in the directory with the <code class="highlighter-rouge">index.html</code>, <code class="highlighter-rouge">spec.json</code> and data files. When that’s done, open your web browser and go the <code class="highlighter-rouge">http://localhost:8000</code>. If your <code class="highlighter-rouge">spec.json</code> looks like the one above, you should see the picture with the 3 blue dots.</p>

<p>If you need help setting up the webserver, check out <a href="https://github.com/processing/p5.js/wiki/Local-server">https://github.com/processing/p5.js/wiki/Local-server</a>.</p>

<h2 id="a-static-image">A static image</h2>

<h3 id="getting-the-data">Getting the data</h3>
<p>The data for this exercise can be downloaded <a href="../assets/flights.csv">here</a> and concerns <strong>flight information</strong> between different cities. Each entry in the dataset contains the following fields:</p>

<ul>
  <li>from_airport</li>
  <li>from_city</li>
  <li>from_country</li>
  <li>from_long</li>
  <li>from_lat</li>
  <li>to_airport</li>
  <li>to_city</li>
  <li>to_country</li>
  <li>to_long</li>
  <li>to_lat</li>
  <li>airline</li>
  <li>airline_country</li>
  <li>distance</li>
</ul>

<p>Alternatively, you can use an external URL as well, as we will do below.</p>

<h3 id="loading-the-external-data">Loading the external data</h3>
<p>Let’s create the same visual as above, but draw a circle for every airport in the file.</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"width"</span><span class="p">:</span><span class="w"> </span><span class="mi">800</span><span class="p">,</span><span class="w">
  </span><span class="nt">"height"</span><span class="p">:</span><span class="w"> </span><span class="mi">400</span><span class="p">,</span><span class="w">

  </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"flights"</span><span class="p">,</span><span class="w">
     </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://vda-lab.github.io/assets/flights.csv"</span><span class="p">,</span><span class="w">
     </span><span class="nt">"format"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"csv"</span><span class="p">,</span><span class="w"> </span><span class="nt">"parse"</span><span class="p">:</span><span class="w"> </span><span class="s2">"auto"</span><span class="p">}}</span><span class="w">
  </span><span class="p">],</span><span class="w">

  </span><span class="nt">"marks"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"symbol"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"from"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"data"</span><span class="p">:</span><span class="s2">"flights"</span><span class="p">},</span><span class="w">
      </span><span class="nt">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"enter"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"x"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"from_long"</span><span class="p">},</span><span class="w">
          </span><span class="nt">"y"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"from_lat"</span><span class="p">},</span><span class="w">
          </span><span class="nt">"size"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">},</span><span class="w">
          </span><span class="nt">"fill"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="s2">"steelblue"</span><span class="p">},</span><span class="w">
          </span><span class="nt">"fillOpacity"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.2</span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>Opening the url <a href="http://localhost:8080">http://localhost:8080</a> will show the visual, which will look like this:</p>

<p><img src="/assets/vega-two.png" alt="vega-two" /></p>

<p><em>Figure 3 - An upside-down map of the world</em></p>

<p>In this plot, we load the data using the <code class="highlighter-rouge">url</code> tag in <code class="highlighter-rouge">data</code>, and let <code class="highlighter-rouge">x</code> and <code class="highlighter-rouge">y</code> be defined by the <code class="highlighter-rouge">from_long</code> and <code class="highlighter-rouge">from_lat</code> values for each datapoint. We set the colour to “steelblue” with the <code class="highlighter-rouge">fill</code> tag, and let these be transparent (<code class="highlighter-rouge">fillOpacity</code>) to make sure that we see overlap if there is one.</p>

<p>Properties are in an <code class="highlighter-rouge">enter</code> tag. Just like D3 which it is based upon, vega uses the <code class="highlighter-rouge">enter</code>-<code class="highlighter-rouge">update</code>-<code class="highlighter-rouge">exit</code> pattern.</p>

<p>Good resources to learn about <code class="highlighter-rouge">enter</code>-<code class="highlighter-rouge">update</code>-<code class="highlighter-rouge">exit</code>:
* <a href="http://javascript.tutorialhorizon.com/2014/11/20/a-visual-explanation-of-the-enter-update-and-exit-selections-in-d3js/">@tutorialhorizon</a></p>

<h3 id="scales">Scales</h3>

<p>Plotting the longitude and latitude of all airports, you’d expect to end up with a map of the world (because - in general - airports are built on land rather than on the water). Unfortunately, what we get is not a good map; it’s upside-down.</p>

<p>To solve this, and to scale the plot to use the whole canvas of 800x400 pixels, we will use the <code class="highlighter-rouge">scale</code> tag. The values for <code class="highlighter-rouge">from_long</code> range from -180 to 180 in the datafile, but the pixels we can use are between 0 and 800. The same goes for the <code class="highlighter-rouge">from_lat</code>: values range from -90 to 90, but we would like to use 0 to 400 on the screen.
In the <code class="highlighter-rouge">spec.json</code> file, add the <code class="highlighter-rouge">scale</code> sections and alter the <code class="highlighter-rouge">x</code> and <code class="highlighter-rouge">y</code> value in the <code class="highlighter-rouge">marks</code>:</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"width"</span><span class="p">:</span><span class="w"> </span><span class="mi">800</span><span class="p">,</span><span class="w">
  </span><span class="nt">"height"</span><span class="p">:</span><span class="w"> </span><span class="mi">400</span><span class="p">,</span><span class="w">

  </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"flights"</span><span class="p">,</span><span class="w">
     </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://vda-lab.github.io/assets/flights.csv"</span><span class="p">,</span><span class="w">
     </span><span class="nt">"format"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"csv"</span><span class="p">,</span><span class="w"> </span><span class="nt">"parse"</span><span class="p">:</span><span class="w"> </span><span class="s2">"auto"</span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">

  </span><span class="nt">"scales"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"scaleLong2X"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"linear"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"domain"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">-180</span><span class="p">,</span><span class="mi">180</span><span class="p">],</span><span class="w">
      </span><span class="nt">"range"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">800</span><span class="p">]</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"scaleLat2Y"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"linear"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"domain"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">-90</span><span class="p">,</span><span class="mi">90</span><span class="p">],</span><span class="w">
      </span><span class="nt">"range"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">400</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">

  </span><span class="nt">"marks"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"symbol"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"from"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"data"</span><span class="p">:</span><span class="s2">"flights"</span><span class="p">},</span><span class="w">
      </span><span class="nt">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"enter"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"x"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"scale"</span><span class="p">:</span><span class="w"> </span><span class="s2">"scaleLong2X"</span><span class="p">,</span><span class="w"> </span><span class="nt">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"from_long"</span><span class="p">},</span><span class="w">
          </span><span class="nt">"y"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"scale"</span><span class="p">:</span><span class="w"> </span><span class="s2">"scaleLat2Y"</span><span class="p">,</span><span class="w"> </span><span class="nt">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"from_lat"</span><span class="p">},</span><span class="w">
          </span><span class="nt">"size"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">},</span><span class="w">
          </span><span class="nt">"fill"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="s2">"steelblue"</span><span class="p">},</span><span class="w">
          </span><span class="nt">"fillOpacity"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.2</span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>We’ll use quite verbose names for the scales, so that we can tell things apart… Each scale contains both the domain and the range in its name (e.g. <code class="highlighter-rouge">scaleLong2X</code>).</p>

<h3 id="different-colours-and-sizes">Different colours and sizes</h3>
<p>What if we want international flights to be coloured blue, and domestic flights coloured red? One way of doing this is to create 2 subsets of the data (one for domestic and one for international flights) using the <code class="highlighter-rouge">filter</code> operation. Change the <code class="highlighter-rouge">data</code> specification to the following:</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="s2">"data"</span><span class="err">:</span><span class="w"> </span><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"domestic_flights"</span><span class="p">,</span><span class="w">
   </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://vda-lab.github.io/assets/flights.csv"</span><span class="p">,</span><span class="w">
   </span><span class="nt">"format"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"csv"</span><span class="p">,</span><span class="w"> </span><span class="nt">"parse"</span><span class="p">:</span><span class="w"> </span><span class="s2">"auto"</span><span class="p">},</span><span class="w">
   </span><span class="nt">"transform"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
     </span><span class="p">{</span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"filter"</span><span class="p">,</span><span class="w"> </span><span class="nt">"test"</span><span class="p">:</span><span class="w"> </span><span class="s2">"datum.from_country == datum.to_country"</span><span class="p">}</span><span class="w">
   </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"international_flights"</span><span class="p">,</span><span class="w">
   </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://vda-lab.github.io/assets/flights.csv"</span><span class="p">,</span><span class="w">
   </span><span class="nt">"format"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"csv"</span><span class="p">,</span><span class="w"> </span><span class="nt">"parse"</span><span class="p">:</span><span class="w"> </span><span class="s2">"auto"</span><span class="p">},</span><span class="w">
   </span><span class="nt">"transform"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
     </span><span class="p">{</span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"filter"</span><span class="p">,</span><span class="w"> </span><span class="nt">"test"</span><span class="p">:</span><span class="w"> </span><span class="s2">"datum.from_country != datum.to_country"</span><span class="p">}</span><span class="w">
   </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>
</div>

<p>See <a href="https://github.com/vega/vega/wiki/Data-Transforms#-filter">here</a> for documentation on the <code class="highlighter-rouge">filter</code> transform.</p>

<p>As you see, we now have 2 different datasets, even though they originate from the same file. The <code class="highlighter-rouge">domestic_flights</code> dataset is filtered so that it contains only those flights where the <code class="highlighter-rouge">from_country</code> is the same as the <code class="highlighter-rouge">to_country</code>. We do a similar thing for the <code class="highlighter-rouge">international_flights</code>. This is not very efficient, though, as we are reading the file twice. It’d be better to use a calculated field.</p>

<p>We now have to change the spec for the marks as well, by drawing these 2 datasets separately.</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="s2">"marks"</span><span class="err">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"symbol"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"from"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"data"</span><span class="p">:</span><span class="s2">"domestic_flights"</span><span class="p">},</span><span class="w">
      </span><span class="nt">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"enter"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"x"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"scale"</span><span class="p">:</span><span class="w"> </span><span class="s2">"scaleLong2X"</span><span class="p">,</span><span class="w"> </span><span class="nt">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"from_long"</span><span class="p">},</span><span class="w">
          </span><span class="nt">"y"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"scale"</span><span class="p">:</span><span class="w"> </span><span class="s2">"scaleLat2Y"</span><span class="p">,</span><span class="w"> </span><span class="nt">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"from_lat"</span><span class="p">},</span><span class="w">
          </span><span class="nt">"size"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">},</span><span class="w">
          </span><span class="nt">"fill"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="s2">"red"</span><span class="p">},</span><span class="w">
          </span><span class="nt">"fillOpacity"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.1</span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"symbol"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"from"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"data"</span><span class="p">:</span><span class="s2">"international_flights"</span><span class="p">},</span><span class="w">
      </span><span class="nt">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"enter"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"x"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"scale"</span><span class="p">:</span><span class="w"> </span><span class="s2">"scaleLong2X"</span><span class="p">,</span><span class="w"> </span><span class="nt">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"from_long"</span><span class="p">},</span><span class="w">
          </span><span class="nt">"y"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"scale"</span><span class="p">:</span><span class="w"> </span><span class="s2">"scaleLat2Y"</span><span class="p">,</span><span class="w"> </span><span class="nt">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"from_lat"</span><span class="p">},</span><span class="w">
          </span><span class="nt">"size"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">},</span><span class="w">
          </span><span class="nt">"fill"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="s2">"blue"</span><span class="p">},</span><span class="w">
          </span><span class="nt">"fillOpacity"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.1</span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">

  </span><span class="p">]</span><span class="w">
</span></code></pre>
</div>

<p>Notice that we now refer to <code class="highlighter-rouge">domestic_flights</code> and <code class="highlighter-rouge">international_flights</code> as the datasets, instead of <code class="highlighter-rouge">flights</code> as before.</p>

<h3 id="different-colours-and-sizes---take-2">Different colours and sizes - take 2</h3>
<p>A better way to do colour domestic flights in red and international ones in blue, is to use an additional scale.</p>

<p>In the <code class="highlighter-rouge">data</code> section, replace what you have for the flight dataset at the moment with the following:</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"flights"</span><span class="p">,</span><span class="w">
 </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://vda-lab.github.io/assets/flights.csv"</span><span class="p">,</span><span class="w">
 </span><span class="nt">"format"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"csv"</span><span class="p">,</span><span class="w"> </span><span class="nt">"parse"</span><span class="p">:</span><span class="w"> </span><span class="s2">"auto"</span><span class="p">},</span><span class="w">
 </span><span class="nt">"transform"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
   </span><span class="p">{</span><span class="w"> </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"formula"</span><span class="p">,</span><span class="w"> </span><span class="nt">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"domestic"</span><span class="p">,</span><span class="w">
     </span><span class="nt">"expr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"datum.from_country == datum.to_country"</span><span class="p">}</span><span class="w">
 </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>
<p>This uses the <code class="highlighter-rouge">formula</code> keyword instead of <code class="highlighter-rouge">filter</code> as before, will check for each flight if the departure country is the same as the arrival country, and put that information in a new field called <code class="highlighter-rouge">domestic</code>.</p>

<p>In the <code class="highlighter-rouge">scales</code> section, add</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"scaleColour"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ordinal"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"domain"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="s2">"flights"</span><span class="p">,</span><span class="w"> </span><span class="nt">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"domestic"</span><span class="p">},</span><span class="w">
  </span><span class="nt">"range"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"red"</span><span class="p">,</span><span class="s2">"blue"</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>Finally, replace the <code class="highlighter-rouge">fill</code> spec in the <code class="highlighter-rouge">marks</code> section with</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="s2">"fill"</span><span class="err">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"scale"</span><span class="p">:</span><span class="w"> </span><span class="s2">"scaleColour"</span><span class="p">,</span><span class="w"> </span><span class="nt">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"domestic"</span><span class="p">}</span><span class="err">,</span><span class="w">
</span></code></pre>
</div>

<p>You’ll get this image:</p>

<p><img src="/assets/flights_coloured_notscaled.png" alt="flights_coloured_notscaled" /></p>

<h3 id="scaling-the-size-of-the-marks">Scaling the size of the marks</h3>
<p>We also want to scale the size of the marks according to the distance of the flights. Similar to what we did above, we add the following <code class="highlighter-rouge">scale</code>:</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"scaleDistance2Radius"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"linear"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"domain"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">15406</span><span class="p">],</span><span class="w">
  </span><span class="nt">"range"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">150</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>Whereas the <code class="highlighter-rouge">size</code> of the marks was <code class="highlighter-rouge"><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">}</span></code>, we now change that to</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="s2">"size"</span><span class="err">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"scale"</span><span class="p">:</span><span class="w"> </span><span class="s2">"scaleDistance2Radius"</span><span class="p">,</span><span class="w"> </span><span class="nt">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"distance"</span><span class="p">}</span><span class="err">,</span><span class="w">
</span></code></pre>
</div>

<p>Resulting image:
<img src="/assets/flights_coloured.png" alt="flights_coloured" /></p>

<h3 id="one-final-overlapping-thing">One final overlapping thing…</h3>
<p>As some of the dots can be relatively big, these can hide smaller dots in the background. One possible solution to this is to first draw the large dots (i.e. the long-distance flights), and draw the smaller ones later. This can be done by adding an additional transformation to the dataset: add the following to the <code class="highlighter-rouge">transform</code> part of the <code class="highlighter-rouge">data</code> section:</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sort"</span><span class="p">,</span><span class="w"> </span><span class="nt">"by"</span><span class="p">:</span><span class="w"> </span><span class="s2">"-distance"</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<h3 id="our-static-image">Our static image</h3>
<p>The final code for this static image:</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"width"</span><span class="p">:</span><span class="w"> </span><span class="mi">800</span><span class="p">,</span><span class="w">
  </span><span class="nt">"height"</span><span class="p">:</span><span class="w"> </span><span class="mi">400</span><span class="p">,</span><span class="w">

  </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">

    </span><span class="p">{</span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"flights"</span><span class="p">,</span><span class="w">
     </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://vda-lab.github.io/assets/flights.csv"</span><span class="p">,</span><span class="w">
     </span><span class="nt">"format"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"csv"</span><span class="p">,</span><span class="w"> </span><span class="nt">"parse"</span><span class="p">:</span><span class="w"> </span><span class="s2">"auto"</span><span class="p">},</span><span class="w">
     </span><span class="nt">"transform"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
       </span><span class="p">{</span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"formula"</span><span class="p">,</span><span class="w"> </span><span class="nt">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"domestic"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"expr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"datum.from_country == datum.to_country"</span><span class="p">},</span><span class="w">
       </span><span class="p">{</span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sort"</span><span class="p">,</span><span class="w"> </span><span class="nt">"by"</span><span class="p">:</span><span class="w"> </span><span class="s2">"-distance"</span><span class="p">}</span><span class="w">
     </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">

  </span><span class="p">],</span><span class="w">

  </span><span class="nt">"scales"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"scaleLong2X"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"linear"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"range"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">800</span><span class="p">],</span><span class="w">
      </span><span class="nt">"domain"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">-180</span><span class="p">,</span><span class="mi">180</span><span class="p">]</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"scaleLat2Y"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"linear"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"range"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">400</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="w">
      </span><span class="nt">"domain"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">-90</span><span class="p">,</span><span class="mi">90</span><span class="p">]</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"scaleColour"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ordinal"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"domain"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="s2">"flights"</span><span class="p">,</span><span class="w"> </span><span class="nt">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"domestic"</span><span class="p">},</span><span class="w">
      </span><span class="nt">"range"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"red"</span><span class="p">,</span><span class="s2">"blue"</span><span class="p">]</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"scaleDistance2Radius"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"linear"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"domain"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">15406</span><span class="p">],</span><span class="w">
      </span><span class="nt">"range"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">150</span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">

  </span><span class="nt">"marks"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"symbol"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"from"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"data"</span><span class="p">:</span><span class="s2">"flights"</span><span class="p">},</span><span class="w">
      </span><span class="nt">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"enter"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"x"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"scale"</span><span class="p">:</span><span class="w"> </span><span class="s2">"scaleLong2X"</span><span class="p">,</span><span class="w"> </span><span class="nt">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"from_long"</span><span class="p">},</span><span class="w">
          </span><span class="nt">"y"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"scale"</span><span class="p">:</span><span class="w"> </span><span class="s2">"scaleLat2Y"</span><span class="p">,</span><span class="w"> </span><span class="nt">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"from_lat"</span><span class="p">},</span><span class="w">
          </span><span class="nt">"size"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"scale"</span><span class="p">:</span><span class="w"> </span><span class="s2">"scaleDistance2Radius"</span><span class="p">,</span><span class="w"> </span><span class="nt">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"distance"</span><span class="p">},</span><span class="w">
          </span><span class="nt">"fill"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"scale"</span><span class="p">:</span><span class="w"> </span><span class="s2">"scaleColour"</span><span class="p">,</span><span class="w"> </span><span class="nt">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"domestic"</span><span class="p">},</span><span class="w">
          </span><span class="nt">"fillOpacity"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.05</span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<h2 id="adding-interactivity">Adding interactivity</h2>
<p>Since version 2.0, vega allows for more complex interactivity, using a reactive approach. For a good presentation on this, see <a href="https://idl.cs.washington.edu/papers/reactive-vega/">this paper</a> by Satyanarajan et al. <em>Definitely</em> check out the vega documentation available at <a href="https://github.com/vega/vega/wiki/Documentation">https://github.com/vega/vega/wiki/Documentation</a>.</p>

<h3 id="detecting-the-mouse">Detecting the mouse</h3>
<p>Let’s say we want to know what the x-position of the mouse is, and display that at the top of the screen. We’ll capture the <code class="highlighter-rouge">mousemove</code> signal and use that as input for a new text mark.</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="s2">"signals"</span><span class="err">:</span><span class="w"> </span><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mouseX"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"streams"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="nt">"type"</span><span class="p">:</span><span class="s2">"*:mousemove"</span><span class="p">,</span><span class="w"> </span><span class="nt">"expr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"event.x"</span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>
</div>
<p>This signal is triggered every time that the mouse is moved, and it returns the x-position of the mouse (<code class="highlighter-rouge">event.x</code>). To make this position appear as text at the top of the screen, we’ll add a new mark. Crucially, we will set the text to not come from a <code class="highlighter-rouge">field</code>, but from this <code class="highlighter-rouge">signal</code>.</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"text"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"interactive"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nt">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"enter"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"x"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">600</span><span class="p">},</span><span class="w">
      </span><span class="nt">"y"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span><span class="w">
      </span><span class="nt">"fill"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"black"</span><span class="p">},</span><span class="w">
      </span><span class="nt">"fontSize"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">},</span><span class="w">
      </span><span class="nt">"align"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"right"</span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"update"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"text"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"signal"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mouseX"</span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>You’ll see that the position reported at the top of the screen will extend beyond the initial 800 pixels that we said the picture should be. That’s because we set the type to <code class="highlighter-rouge">*:mousemove</code>. If we set this to <code class="highlighter-rouge">canvas:mousemove</code>, it will max out at the width of the canvas.</p>

<h3 id="linking-the-mouse-position-to-mark-properties">Linking the mouse position to mark properties</h3>
<p>All airports have their size determined by the distance (<code class="highlighter-rouge">"size": {"scale":"scaleRadius", "field":"distance"}</code>). Let’s try to have this size be determined by the position of the mouse on the screen instead.</p>

<p>As we saw above, we can use <code class="highlighter-rouge">"signal": "mouseX"</code> instead of <code class="highlighter-rouge">"field": "distance"</code>. However, there are 2 additional things we need to take care of. First, we need to add a new scale that scales from the domain “0 -&gt; 800” to the range “3 -&gt; 15”.</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"scaleMouse2Radius"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"linear"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"domain"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">800</span><span class="p">],</span><span class="w">
  </span><span class="nt">"range"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">1500</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>
<p>So we will can now use</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="s2">"size"</span><span class="err">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"scale"</span><span class="p">:</span><span class="s2">"scaleMouse2Radius"</span><span class="p">,</span><span class="w"> </span><span class="nt">"signal"</span><span class="p">:</span><span class="s2">"mouseX"</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>When we refresh our browser, we will however see no points at all… Why is this? This has to do with the enter-update-exit pattern as defined in D3. The <code class="highlighter-rouge">enter</code> part of the <code class="highlighter-rouge">marks</code> section is applied to all datapoints <strong>only once</strong>; to be able to change this (and therefore to have interactivity), we need to put the <code class="highlighter-rouge">size</code> inside an <code class="highlighter-rouge">update</code> section. This is exactly what we did with the text example above as well: the text at the top of the screen is not static, so needs to be put in an <code class="highlighter-rouge">update</code> section.</p>

<h3 id="what-airport-are-we-looking-at">What airport are we looking at?</h3>
<p>Now let’s change the text example above to list the name of the airport that the mouse is hovering over, instead of the mouse position itself.</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="s2">"signals"</span><span class="err">:</span><span class="w"> </span><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"hover"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"init"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"streams"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"symbol:mouseover"</span><span class="p">,</span><span class="w"> </span><span class="nt">"expr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"datum"</span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"symbol:mouseout"</span><span class="p">,</span><span class="w"> </span><span class="nt">"expr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"null"</span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"title"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"init"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Departure airports"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"streams"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"hover"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"expr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"hover ? hover.from_city : 'Departure airports'"</span><span class="w">
    </span><span class="p">}]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>
</div>

<p>As you can see, signals can be used as streams within other signals. The <code class="highlighter-rouge">hover</code> signal registers events every time the mouse enters or leaves (“hovers”) a mark. If it is on a mark, it will return that datum; otherwise it will return null. The <code class="highlighter-rouge">title</code> signal takes this <code class="highlighter-rouge">hover</code> stream as input (<code class="highlighter-rouge">"type": "hover"</code>). Every time this changes, it will return the <code class="highlighter-rouge">from_city</code> of the datum that the mouse is hovering over, or the text “Departure airports” if the mouse is not hovering over a datapoint.</p>

<p>We use the <code class="highlighter-rouge">text</code> mark exactly the same as above.</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"text"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"interactive"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nt">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"enter"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"x"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">600</span><span class="p">},</span><span class="w">
      </span><span class="nt">"y"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span><span class="w">
      </span><span class="nt">"fill"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"black"</span><span class="p">},</span><span class="w">
      </span><span class="nt">"fontSize"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">},</span><span class="w">
      </span><span class="nt">"align"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"right"</span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"update"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"text"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"signal"</span><span class="p">:</span><span class="w"> </span><span class="s2">"title"</span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<h3 id="filtering-airports-based-on-mouse-position">Filtering airports based on mouse position</h3>
<p>We can adapt the above to filter airports based on our mouse position. Suppose that we want to draw only short-distance flights when the mouse is on the left, and long-distance flights when the mouse is on the right. We can do this by defining some additional signals:</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"minDistance"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"streams"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="nt">"type"</span><span class="p">:</span><span class="s2">"mouseX"</span><span class="p">,</span><span class="w"> </span><span class="nt">"expr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"(mouseX-10)*(15406/800)"</span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="err">,</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"maxDistance"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"streams"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="nt">"type"</span><span class="p">:</span><span class="s2">"mouseX"</span><span class="p">,</span><span class="w"> </span><span class="nt">"expr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"(mouseX+10)*(15406/800)"</span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>We then use these signals to set the size of the marks: set it to 20 if the distance of the flight is in this range, otherwise to zero.</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="s2">"marks"</span><span class="err">:</span><span class="w"> </span><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"symbol"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"from"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"data"</span><span class="p">:</span><span class="s2">"flights"</span><span class="p">},</span><span class="w">
    </span><span class="nt">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"enter"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"x"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"scale"</span><span class="p">:</span><span class="w"> </span><span class="s2">"scaleLong2X"</span><span class="p">,</span><span class="w"> </span><span class="nt">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"from_long"</span><span class="p">},</span><span class="w">
        </span><span class="nt">"y"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"scale"</span><span class="p">:</span><span class="w"> </span><span class="s2">"scaleLat2Y"</span><span class="p">,</span><span class="w"> </span><span class="nt">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"from_lat"</span><span class="p">},</span><span class="w">
        </span><span class="nt">"fill"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"scale"</span><span class="p">:</span><span class="w"> </span><span class="s2">"scaleColour"</span><span class="p">,</span><span class="w"> </span><span class="nt">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"domestic"</span><span class="p">},</span><span class="w">
        </span><span class="nt">"fillOpacity"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.2</span><span class="p">}</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"update"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"size"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="p">{</span><span class="w">
            </span><span class="nt">"test"</span><span class="p">:</span><span class="w"> </span><span class="s2">"inrange(datum.distance, minDistance, maxDistance)"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"20"</span><span class="w">
          </span><span class="p">},</span><span class="w">
          </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>
</div>

<p>You’ll see that this works, but is very slow. It’d be better to <em>filter</em> the dataset based on this distance, and only draw those instead of <em>all</em> datapoints most of which we draw with a size zero…</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"width"</span><span class="p">:</span><span class="w"> </span><span class="mi">800</span><span class="p">,</span><span class="w">
  </span><span class="nt">"height"</span><span class="p">:</span><span class="w"> </span><span class="mi">400</span><span class="p">,</span><span class="w">

  </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">

    </span><span class="p">{</span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"flights"</span><span class="p">,</span><span class="w">
     </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://vda-lab.github.io/assets/flights.csv"</span><span class="p">,</span><span class="w">
     </span><span class="nt">"format"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"csv"</span><span class="p">,</span><span class="w"> </span><span class="nt">"parse"</span><span class="p">:</span><span class="w"> </span><span class="s2">"auto"</span><span class="p">},</span><span class="w">
     </span><span class="nt">"transform"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
       </span><span class="p">{</span><span class="w"> </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"formula"</span><span class="p">,</span><span class="w">
         </span><span class="nt">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"domestic"</span><span class="p">,</span><span class="w">
         </span><span class="nt">"expr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"datum.from_country == datum.to_country"</span><span class="p">},</span><span class="w">
       </span><span class="p">{</span><span class="w"> </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sort"</span><span class="p">,</span><span class="w"> </span><span class="nt">"by"</span><span class="p">:</span><span class="w"> </span><span class="s2">"-distance"</span><span class="p">}</span><span class="w">
     </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">

  </span><span class="p">],</span><span class="w">

  </span><span class="nt">"scales"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"scaleLong2X"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"linear"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"range"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">800</span><span class="p">],</span><span class="w">
      </span><span class="nt">"domain"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">-180</span><span class="p">,</span><span class="mi">180</span><span class="p">]</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"scaleLat2Y"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"linear"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"range"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">400</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="w">
      </span><span class="nt">"domain"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">-90</span><span class="p">,</span><span class="mi">90</span><span class="p">]</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"scaleMouse2Distance"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"linear"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"domain"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">800</span><span class="p">],</span><span class="w">
      </span><span class="nt">"range"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">15406</span><span class="p">]</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"scaleColour"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ordinal"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"domain"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="s2">"flights"</span><span class="p">,</span><span class="w"> </span><span class="nt">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"domestic"</span><span class="p">},</span><span class="w">
      </span><span class="nt">"range"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"red"</span><span class="p">,</span><span class="s2">"blue"</span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">

  </span><span class="nt">"signals"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mouseX"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"streams"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="nt">"type"</span><span class="p">:</span><span class="s2">"canvas:mousemove"</span><span class="p">,</span><span class="w"> </span><span class="nt">"expr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"event.x"</span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"minDistance"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"streams"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="nt">"type"</span><span class="p">:</span><span class="s2">"mouseX"</span><span class="p">,</span><span class="w"> </span><span class="nt">"expr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"(mouseX-25)*(15406/800)"</span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"maxDistance"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"streams"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w"> </span><span class="nt">"type"</span><span class="p">:</span><span class="s2">"mouseX"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"scale"</span><span class="p">:</span><span class="w"> </span><span class="s2">"scaleMouse2Distance"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"expr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"(mouseX+25)"</span><span class="w"> </span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">

  </span><span class="nt">"marks"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"symbol"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"from"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"data"</span><span class="p">:</span><span class="s2">"flights"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"transform"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="p">{</span><span class="w"> </span><span class="nt">"type"</span><span class="p">:</span><span class="s2">"filter"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"test"</span><span class="p">:</span><span class="w"> </span><span class="s2">"inrange(datum.distance, minDistance, maxDistance)"</span><span class="w"> </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"enter"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"x"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"scale"</span><span class="p">:</span><span class="w"> </span><span class="s2">"scaleLong2X"</span><span class="p">,</span><span class="w"> </span><span class="nt">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"from_long"</span><span class="p">},</span><span class="w">
          </span><span class="nt">"y"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"scale"</span><span class="p">:</span><span class="w"> </span><span class="s2">"scaleLat2Y"</span><span class="p">,</span><span class="w"> </span><span class="nt">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"from_lat"</span><span class="p">},</span><span class="w">
          </span><span class="nt">"size"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">},</span><span class="w">
          </span><span class="nt">"fill"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"scale"</span><span class="p">:</span><span class="w"> </span><span class="s2">"scaleColour"</span><span class="p">,</span><span class="w"> </span><span class="nt">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"domestic"</span><span class="p">},</span><span class="w">
          </span><span class="nt">"fillOpacity"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.1</span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<h3 id="creating-histograms">Creating histograms</h3>
<p>Let’s try something else and create some histograms. In vega, we can do that using the <code class="highlighter-rouge">bin</code> transform (again: see <a href="https://github.com/vega/vega/wiki/Documentation">https://github.com/vega/vega/wiki/Documentation</a>)</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"width"</span><span class="p">:</span><span class="w"> </span><span class="mi">400</span><span class="p">,</span><span class="w">
  </span><span class="nt">"height"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
  </span><span class="nt">"padding"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"top"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="nt">"left"</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="nt">"bottom"</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="nt">"right"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">},</span><span class="w">
  </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"table"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"values"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="nt">"x"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">  </span><span class="nt">"y"</span><span class="p">:</span><span class="w"> </span><span class="mi">28</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nt">"x"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">  </span><span class="nt">"y"</span><span class="p">:</span><span class="w"> </span><span class="mi">55</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="nt">"x"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">  </span><span class="nt">"y"</span><span class="p">:</span><span class="w"> </span><span class="mi">43</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nt">"x"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">  </span><span class="nt">"y"</span><span class="p">:</span><span class="w"> </span><span class="mi">91</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="nt">"x"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">  </span><span class="nt">"y"</span><span class="p">:</span><span class="w"> </span><span class="mi">81</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nt">"x"</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w">  </span><span class="nt">"y"</span><span class="p">:</span><span class="w"> </span><span class="mi">53</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="nt">"x"</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w">  </span><span class="nt">"y"</span><span class="p">:</span><span class="w"> </span><span class="mi">19</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nt">"x"</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w">  </span><span class="nt">"y"</span><span class="p">:</span><span class="w"> </span><span class="mi">87</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="nt">"x"</span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w">  </span><span class="nt">"y"</span><span class="p">:</span><span class="w"> </span><span class="mi">52</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nt">"x"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="nt">"y"</span><span class="p">:</span><span class="w"> </span><span class="mi">48</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="nt">"x"</span><span class="p">:</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="nt">"y"</span><span class="p">:</span><span class="w"> </span><span class="mi">24</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nt">"x"</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="nt">"y"</span><span class="p">:</span><span class="w"> </span><span class="mi">49</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="nt">"x"</span><span class="p">:</span><span class="w"> </span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="nt">"y"</span><span class="p">:</span><span class="w"> </span><span class="mi">87</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nt">"x"</span><span class="p">:</span><span class="w"> </span><span class="mi">14</span><span class="p">,</span><span class="w"> </span><span class="nt">"y"</span><span class="p">:</span><span class="w"> </span><span class="mi">66</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="nt">"x"</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="nt">"y"</span><span class="p">:</span><span class="w"> </span><span class="mi">17</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nt">"x"</span><span class="p">:</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="nt">"y"</span><span class="p">:</span><span class="w"> </span><span class="mi">27</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="nt">"x"</span><span class="p">:</span><span class="w"> </span><span class="mi">17</span><span class="p">,</span><span class="w"> </span><span class="nt">"y"</span><span class="p">:</span><span class="w"> </span><span class="mi">68</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nt">"x"</span><span class="p">:</span><span class="w"> </span><span class="mi">18</span><span class="p">,</span><span class="w"> </span><span class="nt">"y"</span><span class="p">:</span><span class="w"> </span><span class="mi">16</span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="nt">"x"</span><span class="p">:</span><span class="w"> </span><span class="mi">19</span><span class="p">,</span><span class="w"> </span><span class="nt">"y"</span><span class="p">:</span><span class="w"> </span><span class="mi">49</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nt">"x"</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="nt">"y"</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nt">"transform"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"type"</span><span class="p">:</span><span class="s2">"bin"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"field"</span><span class="p">:</span><span class="s2">"y"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"maxbins"</span><span class="p">:</span><span class="mi">5</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"type"</span><span class="p">:</span><span class="s2">"aggregate"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"groupby"</span><span class="p">:[</span><span class="s2">"bin_mid"</span><span class="p">],</span><span class="w">
          </span><span class="nt">"summarize"</span><span class="p">:{</span><span class="nt">"bin_mid"</span><span class="p">:</span><span class="s2">"count"</span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nt">"scales"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"x"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ordinal"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"range"</span><span class="p">:</span><span class="w"> </span><span class="s2">"width"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"domain"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="s2">"table"</span><span class="p">,</span><span class="w"> </span><span class="nt">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bin_mid"</span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"y"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"linear"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"range"</span><span class="p">:</span><span class="w"> </span><span class="s2">"height"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"domain"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="s2">"table"</span><span class="p">,</span><span class="w"> </span><span class="nt">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"count_bin_mid"</span><span class="p">},</span><span class="w">
      </span><span class="nt">"nice"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nt">"axes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"x"</span><span class="p">,</span><span class="w"> </span><span class="nt">"scale"</span><span class="p">:</span><span class="w"> </span><span class="s2">"x"</span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"y"</span><span class="p">,</span><span class="w"> </span><span class="nt">"scale"</span><span class="p">:</span><span class="w"> </span><span class="s2">"y"</span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nt">"marks"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rect"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"from"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="s2">"table"</span><span class="p">},</span><span class="w">
      </span><span class="nt">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"enter"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"x"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"scale"</span><span class="p">:</span><span class="w"> </span><span class="s2">"x"</span><span class="p">,</span><span class="w"> </span><span class="nt">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bin_mid"</span><span class="p">},</span><span class="w">
          </span><span class="nt">"width"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"scale"</span><span class="p">:</span><span class="w"> </span><span class="s2">"x"</span><span class="p">,</span><span class="w"> </span><span class="nt">"band"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nt">"offset"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span><span class="w">
          </span><span class="nt">"y"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"scale"</span><span class="p">:</span><span class="w"> </span><span class="s2">"y"</span><span class="p">,</span><span class="w"> </span><span class="nt">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"count_bin_mid"</span><span class="p">},</span><span class="w">
          </span><span class="nt">"y2"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"scale"</span><span class="p">:</span><span class="w"> </span><span class="s2">"y"</span><span class="p">,</span><span class="w"> </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"update"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"fill"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"steelblue"</span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"hover"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"fill"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"red"</span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>The key here is the <code class="highlighter-rouge">transform</code> that is applied to the data. Before this transformation, the data looks like this:</p>

<table>
  <thead>
    <tr>
      <th>x</th>
      <th>y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>28</td>
    </tr>
    <tr>
      <td>2</td>
      <td>55</td>
    </tr>
    <tr>
      <td>3</td>
      <td>43</td>
    </tr>
    <tr>
      <td>…</td>
      <td>…</td>
    </tr>
  </tbody>
</table>

<p>The data before transformation looks like this:</p>

<p><img src="/assets/rawxy.png" alt="rawxy" /></p>

<p>We’re applying two different transformations, and their order is important here. Switching the two will not give you the plot you saw above.</p>

<p>The first transformation (<code class="highlighter-rouge">bin</code>) basically adds some new columns to the data: <code class="highlighter-rouge">bin_start</code>, <code class="highlighter-rouge">bin_end</code> and <code class="highlighter-rouge">bin_mid</code>. The intermediate data therefore looks like this.</p>

<table>
  <thead>
    <tr>
      <th>x</th>
      <th>y</th>
      <th>bin_start</th>
      <th>bin_end</th>
      <th>bin_mid</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>28</td>
      <td>20</td>
      <td>40</td>
      <td>30</td>
    </tr>
    <tr>
      <td>2</td>
      <td>55</td>
      <td>40</td>
      <td>60</td>
      <td>50</td>
    </tr>
    <tr>
      <td>3</td>
      <td>43</td>
      <td>40</td>
      <td>60</td>
      <td>50</td>
    </tr>
    <tr>
      <td>…</td>
      <td>…</td>
      <td>…</td>
      <td>…</td>
      <td>…</td>
    </tr>
  </tbody>
</table>

<p>The second transformation (<code class="highlighter-rouge">aggregate</code>) takes this new <code class="highlighter-rouge">bin_mid</code> column and performs a count. The transformed data now looks like this:</p>

<table>
  <thead>
    <tr>
      <th>bin_mid</th>
      <th>count_bin_mid</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>10</td>
      <td>4</td>
    </tr>
    <tr>
      <td>30</td>
      <td>3</td>
    </tr>
    <tr>
      <td>…</td>
      <td>…</td>
    </tr>
  </tbody>
</table>

<p>We can then use this <code class="highlighter-rouge">count_bin_mid</code> in the definition of the marks to set the value for <code class="highlighter-rouge">y</code>. The picture you get:</p>

<p><img src="/assets/histogramxy.png" alt="histogramxy" /></p>

<h2 id="further-information">Further information</h2>
<p>Hopefully this gives you some indication of how vega works and what you can do with it. The data transformation aspect of vega is actually quite powerful. Dig into the data transform <a href="https://github.com/vega/vega/wiki/Data-Transforms">documentation</a> to try more things out. The <a href="https://github.com/vega/vega/wiki/Expressions">expressions documents</a> also gives some more information on how to reference mouse events, the canvas, etc.</p>

<h3 id="debugging">Debugging</h3>
<p>Vega recently added a very cool interface for debugging your specification. See <a href="http://vega.github.io/vega-tutorials/debugging/">http://vega.github.io/vega-tutorials/debugging/</a>.</p>

  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <img src="/assets/uhasselt_logo.png"/ width="180px"> <h2 class="footer-heading">AI @ UHasselt</h2>

  </div>

</footer>


  </body>

</html>
